{% extends "layouts/privateLayout.njk" %}

{% block content %}
<div id="profileContainer">
    <h1>Perfil del Usuario</h1>
    
    <div class="profile-details">
        <h2>Información Personal</h2>
        <form id="profileForm" method="POST" action="/api/update">
            <label for="name">Nombre:</label>
            <input type="text" name="name" required id="nameInput" class="transparent-input">
            
            <label for="surnames">Apellidos:</label>
            <input type="text" name="surnames" required id="surnamesInput" class="transparent-input">
            
            <label for="email">Email:</label>
            <input type="email" name="email" required id="emailInput" class="transparent-input">
            
            <label for="gender">Género:</label>
            <select name="gender" id="genderSelect" class="transparent-input">
                <option value="masculino">Masculino</option>
                <option value="femenino">Femenino</option>
                <option value="otro">Otro</option>
            </select>

            <label for="createdAt">Fecha de Registro:</label>
            <input type="text" name="createdAt" disabled id="createdAtInput" class="transparent-input"> <!-- Solo lectura -->

            <div class="profile-actions">
                <button type="button" class="button" id="editButton">Modificar</button>
                <button type="button" class="button" style="display:none;" id="cancelButton">Cancelar</button>
                <button type="submit" class="button" style="display:none;" id="updateButton">Actualizar Perfil</button>
            </div>
        </form>
    </div>
</div>

<style>
    
    .transparent-input {
        background-color: transparent;
        border: none;
        border-bottom: 1px solid #ccc; 
        color: #000; 
        width: 100%;
        padding: 5px;
        transition: border-bottom-color 0.3s ease; 
    }

    .transparent-input:disabled {
        opacity: 0.5; 
    }

    .button {
        margin-top: 10px; 
        cursor: pointer;
    }

    .button:hover {
        background-color: #f0f0f0; 
        color: #000; 
    }
</style>

<script type="module">
    import { loadUserProfile } from '../js/services/profileService.js';
    import { getState, setState } from '../js/reducers/state.js'; 

    
    async function fetchUserProfile() {
        try {
            const user = await loadUserProfile(); 
            
            
            setState({ profile: user });

            
            document.getElementById('nameInput').value = user.name || '';
            document.getElementById('surnamesInput').value = user.surnames || '';
            document.getElementById('emailInput').value = user.email || '';
            document.getElementById('genderSelect').value = user.gender || 'masculino';
            document.getElementById('createdAtInput').value = new Date(user.createdAt).toLocaleDateString();
        } catch (error) {
            console.error('Error al obtener el perfil del usuario:', error);
            alert('No se pudo obtener el perfil. Intenta de nuevo más tarde.');
        }
    }

    
    document.getElementById('editButton').addEventListener('click', () => {
        
        document.getElementById('nameInput').disabled = false;
        document.getElementById('surnamesInput').disabled = false;
        document.getElementById('emailInput').disabled = false;
        document.getElementById('genderSelect').disabled = false;
        
        
        document.getElementById('updateButton').style.display = 'inline-block';
        document.getElementById('cancelButton').style.display = 'inline-block';
        document.getElementById('editButton').style.display = 'none'; 
    });

    document.getElementById('cancelButton').addEventListener('click', () => {
        
        const profile = getState().profile; 
        document.getElementById('nameInput').value = profile.name || '';
        document.getElementById('surnamesInput').value = profile.surnames || '';
        document.getElementById('emailInput').value = profile.email || '';
        document.getElementById('genderSelect').value = profile.gender || 'masculino';

        
        document.getElementById('nameInput').disabled = true;
        document.getElementById('surnamesInput').disabled = true;
        document.getElementById('emailInput').disabled = true;
        document.getElementById('genderSelect').disabled = true;

        
        document.getElementById('updateButton').style.display = 'none';
        document.getElementById('cancelButton').style.display = 'none';
        document.getElementById('editButton').style.display = 'inline-block'; 
    });

    
    document.addEventListener('DOMContentLoaded', fetchUserProfile);
</script>
{% endblock %}
